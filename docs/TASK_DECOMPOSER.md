# 任务分解引擎设计

## 核心能力
把用户的高层目标，自动拆分成可执行的命令序列。

## 设计思路

### 输入 → 理解 → 分解 → 执行 → 反馈

```
用户输入: "帮我整理桌面"
    ↓
意图理解: 分类整理文件
    ↓
任务分解:
  1. dir 桌面 → 获取文件列表
  2. mkdir 桌面/文档 → 创建分类文件夹
  3. mv *.docx 桌面/文档 → 移动文档
  4. mv *.jpg 桌面/图片 → 移动图片
    ↓
依次执行 → 返回结果
```

## 预置任务模板

### 1. 整理桌面
```
patterns: ["整理桌面", "清理桌面", "桌面文件整理"]
steps:
  - get_files: "dir %USERPROFILE%\\Desktop"
  - create_folders: ["文档", "图片", "工具", "其他"]
  - classify_files: 按类型移动
```

### 2. 整理下载文件夹
```
patterns: ["整理下载", "清理下载", "下载文件整理"]
steps:
  - get_files: "dir %USERPROFILE%\\Downloads"
  - create_folders: ["安装包", "文档", "图片", "压缩包"]
  - classify_files: 按类型移动
```

### 3. 创建项目
```
patterns: ["创建项目", "新建项目"]
steps:
  - mkdir: 项目文件夹
  - mkdir: 项目/src
  - mkdir: 项目/docs
  - create_file: 项目/README.md
```

### 4. 代码部署
```
patterns: ["部署代码", "发布代码"]
steps:
  - git add: .
  - git commit: 自动生成提交信息
  - git push: 推送到远程
```

## 实现优先级

### Phase 3-1: 基础任务分解
- [ ] 意图识别（关键词匹配）
- [ ] 任务模板系统
- [ ] 步骤执行器
- [ ] 进度反馈

### Phase 3-2: 增强能力
- [ ] 自然语言理解
- [ ] 自定义模板
- [ ] 任务历史记录
- [ ] 失败重试

## 用户体验

### 对话式交互
```
用户: "帮我整理桌面"
AImum: "好的！我来帮你整理桌面。
        
        计划：
        1. 查看桌面文件
        2. 创建分类文件夹
        3. 按类型整理文件
        
        开始执行..."
        
执行中...
✅ 查看桌面：发现 23 个文件
✅ 创建分类文件夹：文档、图片、安装包、其他
✅ 移动文档：8 个文件
✅ 移动图片：5 个文件
✅ ...

完成！桌面已整理完毕！
"""
```

## 技术实现

```javascript
// 任务分解器
class TaskDecomposer {
  // 匹配任务类型
  matchTask(input) {
    const patterns = {
      'organize_desktop': ['整理桌面', '清理桌面'],
      'organize_downloads': ['整理下载', '清理下载'],
      'create_project': ['创建项目', '新建项目'],
      'deploy': ['部署代码', '发布代码']
    };
    
    // 返回匹配的任务类型
  }
  
  // 分解任务
  decompose(taskType) {
    // 根据类型返回执行步骤
  }
  
  // 执行步骤
  async executeStep(step) {
    // 调用命令执行器
  }
}
```

## 下一步行动

1. **创建任务分解器** - core.js
2. **添加任务模板** - 预置常用任务
3. **实现步骤执行** - 依次执行命令
4. **添加用户确认** - 执行前询问用户

---

预计工时：2-3 小时
优先级：🔴 高
