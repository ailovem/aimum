<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AImum - æ’ä»¶å¸‚åœº</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --primary: #667eea;
      --bg: #0f0f23;
      --card: #1a1a2e;
      --card-hover: #252542;
      --text: #e2e8f0;
      --text-dim: #a0aec0;
      --success: #10b981;
      --warning: #f59e0b;
      --border: rgba(255,255,255,0.1);
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      padding: 40px 20px;
      margin-bottom: 30px;
    }
    
    h1 {
      font-size: 36px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .subtitle {
      color: var(--text-dim);
    }
    
    /* æ ‡ç­¾é¡µ */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 20px;
    }
    
    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: var(--text-dim);
      cursor: pointer;
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .tab:hover {
      background: var(--card-hover);
    }
    
    .tab.active {
      background: var(--primary);
      color: white;
    }
    
    /* æœç´¢æ  */
    .search-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .search-input {
      flex: 1;
      padding: 14px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      color: var(--text);
      font-size: 15px;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .search-input::placeholder {
      color: var(--text-dim);
    }
    
    .sort-select {
      padding: 14px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
    }
    
    /* åˆ†ç±»æ ‡ç­¾ */
    .categories {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .category {
      padding: 10px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 25px;
      color: var(--text-dim);
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .category:hover {
      border-color: var(--primary);
    }
    
    .category.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    /* æ’ä»¶ç½‘æ ¼ */
    .plugins-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
    }
    
    .plugin-card {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }
    
    .plugin-card:hover {
      border-color: var(--primary);
      transform: translateY(-4px);
    }
    
    .plugin-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .plugin-icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--primary), #764ba2);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      flex-shrink: 0;
    }
    
    .plugin-info {
      flex: 1;
      min-width: 0;
    }
    
    .plugin-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .plugin-author {
      font-size: 13px;
      color: var(--text-dim);
    }
    
    .plugin-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .plugin-badge.builtin {
      background: rgba(102, 126, 234, 0.2);
      color: var(--primary);
    }
    
    .plugin-badge.paid {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }
    
    .plugin-description {
      color: var(--text-dim);
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    
    .plugin-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    
    .plugin-tag {
      padding: 4px 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      font-size: 12px;
      color: var(--text-dim);
    }
    
    .plugin-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    
    .plugin-price {
      font-size: 16px;
      font-weight: 600;
      color: var(--primary);
    }
    
    .plugin-price.free {
      color: var(--success);
    }
    
    .plugin-action {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .plugin-action.install {
      background: var(--primary);
      color: white;
    }
    
    .plugin-action.install:hover {
      background: #5a67d8;
    }
    
    .plugin-action.uninstall {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
    }
    
    .plugin-action.uninstall:hover {
      background: rgba(239, 68, 68, 0.3);
    }
    
    .plugin-action.enabled {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }
    
    .plugin-action.disabled {
      background: rgba(255,255,255,0.1);
      color: var(--text-dim);
    }
    
    /* å·²å®‰è£…æ ‡ç­¾é¡µ */
    .installed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    
    .installed-card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      border: 1px solid var(--border);
    }
    
    .installed-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary), #764ba2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }
    
    .installed-info {
      flex: 1;
      min-width: 0;
    }
    
    .installed-name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .installed-status {
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .status-dot.enabled {
      background: var(--success);
    }
    
    .status-dot.disabled {
      background: var(--text-dim);
    }
    
    .installed-toggle {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-dim);
      cursor: pointer;
      font-size: 12px;
    }
    
    .installed-toggle:hover {
      border-color: var(--primary);
      color: var(--text);
    }
    
    /* ç©ºçŠ¶æ€ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-dim);
    }
    
    .empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    
    .empty-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
    }
    
    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .search-bar {
        flex-direction: column;
      }
      
      .tabs {
        overflow-x: auto;
        padding-bottom: 10px;
      }
      
      .plugin-card {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¦ æ’ä»¶å¸‚åœº</h1>
      <p class="subtitle">æ‰©å±• AImum çš„èƒ½åŠ›ï¼Œè®© AI æ›´å¼ºå¤§</p>
    </header>
    
    <!-- æ ‡ç­¾é¡µ -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('explore')">
        ğŸ” æ¢ç´¢æ’ä»¶
      </button>
      <button class="tab" onclick="switchTab('installed')">
        ğŸ“¦ å·²å®‰è£…
      </button>
    </div>
    
    <!-- æ¢ç´¢æ’ä»¶ -->
    <div id="exploreTab">
      <!-- æœç´¢æ  -->
      <div class="search-bar">
        <input type="text" class="search-input" id="searchInput" 
               placeholder="æœç´¢æ’ä»¶..." onkeyup="handleSearch(event)">
        <select class="sort-select" id="sortSelect" onchange="handleSort()">
          <option value="popular">ğŸ”¥ çƒ­é—¨</option>
          <option value="newest">ğŸ†• æœ€æ–°</option>
          <option value="price">ğŸ’° ä»·æ ¼</option>
        </select>
      </div>
      
      <!-- åˆ†ç±» -->
      <div class="categories" id="categories">
        <!-- åˆ†ç±»ä¼šåŠ¨æ€åŠ è½½ -->
      </div>
      
      <!-- æ’ä»¶åˆ—è¡¨ -->
      <div class="plugins-grid" id="pluginsGrid">
        <!-- æ’ä»¶ä¼šåŠ¨æ€åŠ è½½ -->
      </div>
    </div>
    
    <!-- å·²å®‰è£… -->
    <div id="installedTab" style="display: none;">
      <div class="installed-grid" id="installedGrid">
        <!-- å·²å®‰è£…æ’ä»¶ä¼šåŠ¨æ€åŠ è½½ -->
      </div>
      
      <div class="empty-state" id="emptyInstalled" style="display: none;">
        <div class="empty-icon">ğŸ“¦</div>
        <div class="empty-title">æš‚æ— å·²å®‰è£…æ’ä»¶</div>
        <p>å»æ¢ç´¢æ’ä»¶å¸‚åœºå®‰è£…æ›´å¤šæ’ä»¶å§ï¼</p>
      </div>
    </div>
  </div>
  
  <script>
    const API_BASE = '/api/plugins';
    let currentTab = 'explore';
    let currentCategory = 'all';
    let currentSort = 'popular';
    let searchKeyword = '';
    let installedPlugins = new Map();
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      loadCategories();
      loadPlugins();
      loadInstalled();
    });
    
    // åˆ‡æ¢æ ‡ç­¾é¡µ
    function switchTab(tab) {
      currentTab = tab;
      
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab')[tab === 'explore' ? 0 : 1].classList.add('active');
      
      document.getElementById('exploreTab').style.display = tab === 'explore' ? 'block' : 'none';
      document.getElementById('installedTab').style.display = tab === 'installed' ? 'block' : 'none';
    }
    
    // åŠ è½½åˆ†ç±»
    async function loadCategories() {
      try {
        const res = await fetch(`${API_BASE}/categories`);
        const data = await res.json();
        
        if (data.success) {
          const container = document.getElementById('categories');
          container.innerHTML = data.data.categories.map(cat => `
            <div class="category ${cat.id === currentCategory ? 'active' : ''}" 
                 onclick="selectCategory('${cat.id}')">
              ${cat.icon} ${cat.name} (${cat.count})
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
      }
    }
    
    // é€‰æ‹©åˆ†ç±»
    function selectCategory(category) {
      currentCategory = category;
      
      document.querySelectorAll('.category').forEach(cat => {
        cat.classList.toggle('active', cat.textContent.includes(category) || 
          (category === 'all' && cat.textContent.includes('å…¨éƒ¨')));
      });
      
      loadPlugins();
    }
    
    // å¤„ç†æœç´¢
    function handleSearch(event) {
      searchKeyword = event.target.value;
      loadPlugins();
    }
    
    // å¤„ç†æ’åº
    function handleSort() {
      currentSort = document.getElementById('sortSelect').value;
      loadPlugins();
    }
    
    // åŠ è½½æ’ä»¶åˆ—è¡¨
    async function loadPlugins() {
      try {
        let url = `${API_BASE}/plugins?category=${currentCategory}&sort=${currentSort}`;
        if (searchKeyword) {
          url += `&search=${encodeURIComponent(searchKeyword)}`;
        }
        
        const res = await fetch(url);
        const data = await res.json();
        
        if (data.success) {
          renderPlugins(data.data.plugins);
        }
      } catch (error) {
        console.error('åŠ è½½æ’ä»¶å¤±è´¥:', error);
      }
    }
    
    // æ¸²æŸ“æ’ä»¶
    function renderPlugins(plugins) {
      const grid = document.getElementById('pluginsGrid');
      
      if (plugins.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <div class="empty-icon">ğŸ”</div>
            <div class="empty-title">æœªæ‰¾åˆ°æ’ä»¶</div>
            <p>è¯•è¯•å…¶ä»–å…³é”®è¯æˆ–åˆ†ç±»</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = plugins.map(plugin => `
        <div class="plugin-card">
          <div class="plugin-header">
            <div class="plugin-icon">${plugin.icon}</div>
            <div class="plugin-info">
              <div class="plugin-name">
                ${plugin.name}
                ${plugin.builtin ? '<span class="plugin-badge builtin">å†…ç½®</span>' : ''}
                ${plugin.price > 0 ? '<span class="plugin-badge paid">ä»˜è´¹</span>' : ''}
              </div>
              <div class="plugin-author">by ${plugin.author}</div>
            </div>
          </div>
          
          <div class="plugin-description">${plugin.description}</div>
          
          <div class="plugin-tags">
            ${plugin.tags.map(tag => `<span class="plugin-tag">${tag}</span>`).join('')}
          </div>
          
          <div class="plugin-footer">
            <div class="plugin-price ${plugin.price === 0 ? 'free' : ''}">
              ${plugin.price === 0 ? 'å…è´¹' : `${plugin.price} tokens/æ¬¡`}
            </div>
            <button class="plugin-action ${installedPlugins.has(plugin.id) ? 'uninstall' : 'install'}"
                    onclick="${installedPlugins.has(plugin.id) ? `uninstallPlugin('${plugin.id}')` : `installPlugin('${plugin.id}')`}">
              ${installedPlugins.has(plugin.id) ? 'å¸è½½' : 'å®‰è£…'}
            </button>
          </div>
        </div>
      `).join('');
    }
    
    // åŠ è½½å·²å®‰è£…æ’ä»¶
    async function loadInstalled() {
      try {
        const res = await fetch(`${API_BASE}/installed`);
        const data = await res.json();
        
        if (data.success) {
          installedPlugins.clear();
          data.data.plugins.forEach(p => {
            installedPlugins.set(p.id, p);
          });
          
          renderInstalled(data.data.plugins);
        }
      } catch (error) {
        console.error('åŠ è½½å·²å®‰è£…æ’ä»¶å¤±è´¥:', error);
      }
    }
    
    // æ¸²æŸ“å·²å®‰è£…æ’ä»¶
    function renderInstalled(plugins) {
      const grid = document.getElementById('installedGrid');
      const empty = document.getElementById('emptyInstalled');
      
      if (plugins.length === 0) {
        grid.style.display = 'none';
        empty.style.display = 'block';
        return;
      }
      
      grid.style.display = 'grid';
      empty.style.display = 'none';
      
      grid.innerHTML = plugins.map(plugin => `
        <div class="installed-card">
          <div class="installed-icon">${plugin.icon}</div>
          <div class="installed-info">
            <div class="installed-name">${plugin.name}</div>
            <div class="installed-status">
              <span class="status-dot ${plugin.enabled ? 'enabled' : 'disabled'}"></span>
              ${plugin.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}
            </div>
          </div>
          <button class="installed-toggle" onclick="togglePlugin('${plugin.id}', ${!plugin.enabled})">
            ${plugin.enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
          </button>
        </div>
      `).join('');
    }
    
    // å®‰è£…æ’ä»¶
    async function installPlugin(pluginId) {
      try {
        const res = await fetch(`${API_BASE}/install`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pluginId })
        });
        
        const data = await res.json();
        
        if (data.success) {
          alert('æ’ä»¶å®‰è£…æˆåŠŸï¼');
          loadInstalled();
          loadPlugins();
        } else {
          alert(data.error || 'å®‰è£…å¤±è´¥');
        }
      } catch (error) {
        console.error('å®‰è£…å¤±è´¥:', error);
        alert('å®‰è£…å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }
    
    // å¸è½½æ’ä»¶
    async function uninstallPlugin(pluginId) {
      if (!confirm('ç¡®å®šè¦å¸è½½è¿™ä¸ªæ’ä»¶å—ï¼Ÿ')) return;
      
      try {
        const res = await fetch(`${API_BASE}/uninstall`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pluginId })
        });
        
        const data = await res.json();
        
        if (data.success) {
          alert('æ’ä»¶å¸è½½æˆåŠŸï¼');
          loadInstalled();
          loadPlugins();
        } else {
          alert(data.error || 'å¸è½½å¤±è´¥');
        }
      } catch (error) {
        console.error('å¸è½½å¤±è´¥:', error);
        alert('å¸è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }
    
    // åˆ‡æ¢æ’ä»¶çŠ¶æ€
    async function togglePlugin(pluginId, enabled) {
      try {
        const res = await fetch(`${API_BASE}/toggle`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pluginId, enabled })
        });
        
        const data = await res.json();
        
        if (data.success) {
          loadInstalled();
        } else {
          alert(data.error || 'æ“ä½œå¤±è´¥');
        }
      } catch (error) {
        console.error('æ“ä½œå¤±è´¥:', error);
      }
    }
  </script>
</body>
</html>
